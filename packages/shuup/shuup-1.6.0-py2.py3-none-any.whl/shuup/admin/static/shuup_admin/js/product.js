"use strict";var _slicedToArray=function(){function e(e,t){var a=[],i=!0,r=!1,n=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(a.push(o.value),!t||a.length!==t);i=!0);}catch(d){r=!0,n=d}finally{try{!i&&s["return"]&&s["return"]()}finally{if(r)throw n}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();$(function(){function e(e,t){var a=e.attr("id"),i=$("#"+a+" .panel").length,r=$("#"+a+"-placeholder-panel"),n=$(r.html().replace(/__prefix__/g,i-1).replace(/__prefix_name__/g,i)),o="id_images";if(a.indexOf("media")>0&&(o="id_media"),t){var s=$("<a href='"+t.url+"' target='_blank'></a>");"id_images"===o?(s.append("<img src='"+t.url+"'>"),n.find(".thumbnail").append(s)):(s.append("<br><p>"+t.name+"</p>"),n.find(".thumbnail").append(s)),n.find(".file-control").find("input").val(t.id)}n.insertBefore(r)}function t(e,t){if(!(location.pathname.indexOf("new")>0)){for(var a=$("#product-"+t+"-section-dropzone").data().product_id,i=$("#product-"+t+"-section").find(".file-control input"),r=[],n=0;n<i.length;n++){var o=parseInt($(i[n]).val());isNaN(o)||r.push(parseInt($(i[n]).val()))}$.ajax({url:"/sa/products/"+a+"/media/add/",method:"POST",data:{csrfmiddlewaretoken:ShuupAdminConfig.csrf,product_id:a,file_ids:r,kind:t},traditional:!0,success:function(e){window.Messages.enqueue({tags:"success",text:e.message})},error:function(e){alert("ERROR")}})}}function a(t,a){a.xhr&&(a=JSON.parse(a.xhr.responseText).file),e(t,a)}$(".product-media-delete").on("click",function(e){e.preventDefault(),confirm(gettext("Are you sure you want to delete this media?"))&&($(this).parents(".panel").fadeOut(),$(this).next(".hide").find("input").prop("checked",!0))}),$(document).on("click",".set-as-primary",function(e){e.preventDefault();var t=$(this).parents(".panel"),a=t.data("prefix"),i=a.split("-"),r=_slicedToArray(i,2),n=r[1],o=$("#product-images-section .panel");o.removeClass("panel-selected").addClass("panel-default"),$(".is-primary-image").replaceWith(function(){return $("<a>",{"class":"set-as-primary",href:"#"}).text(gettext("Set as primary image"))}),o.each(function(e){$("#id_images-"+e+"-is_primary").prop("checked",!1)}),$(this).replaceWith(function(){return $("<span>",{"class":"is-primary-image"}).text(gettext("Primary image"))}),t.addClass("panel-selected"),$("#id_images-"+n+"-is_primary").prop("checked",!0)});var i=[{field:"product-images-section",targetPath:"/products/images",maxFiles:10,queueComplete:"images"},{field:"product-media-section",targetPath:"/products/media",maxFiles:10,queueComplete:"media"}];i.forEach(function(e){var i="#"+e.field+"-dropzone";if($(i).length){var r=window.ShuupAdminConfig.browserUrls.media;activateDropzone($(i),{url:r+"?action=upload&path="+e.targetPath,maxFiles:e.maxFiles,onSuccess:function(t){a($("#"+e.field),t)},onQueueComplete:function(){t(this,e.queueComplete)}})}})});
//# sourceMappingURL=product.js.map
