
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Scapy development &#8212; kamene 3.0.0 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Credits" href="backmatter.html" />
    <link rel="prev" title="Troubleshooting" href="troubleshooting.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="scapy-development">
<h1>Scapy development<a class="headerlink" href="#scapy-development" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is only partly updated for kamene yet. Code examples may not work directly.</p>
</div>
<div class="section" id="project-organization">
<h2>Project organization<a class="headerlink" href="#project-organization" title="Permalink to this headline">¶</a></h2>
<p>kamene development uses the <a class="reference external" href="http://github.com/phaethon/scapy">GitHub repository</a>
kamene is not synchronized with scapy v2.x repository at <a class="reference external" href="http://hg.secdev.org/scapy/">http://hg.secdev.org/scapy/</a>. Changes in one project reflect on the other only if somebody manually transfers the change.</p>
</div>
<div class="section" id="how-to-contribute">
<h2>How to contribute<a class="headerlink" href="#how-to-contribute" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Found a bug in kamene? <a class="reference external" href="http://github.com/phaethon/scapy/issues">Add a ticket</a>.</li>
<li>Improve this documentation.</li>
<li>Program a new layer and create a pull request.</li>
<li>Contribute new regression tests.</li>
<li>Upload packet samples for new protocols.</li>
</ul>
</div>
<div class="section" id="testing-with-utscapy">
<h2>Testing with UTScapy<a class="headerlink" href="#testing-with-utscapy" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-is-utscapy">
<h3>What is UTScapy?<a class="headerlink" href="#what-is-utscapy" title="Permalink to this headline">¶</a></h3>
<p>UTScapy is a small Python program that reads a campaign of tests, runs the campaign with Scapy and generates a report indicating test status. The report may be in one of four formats, text, ansi, HTML or LaTeX.</p>
<p>Three basic test containers exist with UTScapy, a unit test, a test set and a test campaign. A unit test is a list of Scapy commands that will be run by Scapy or a derived work of Scapy. Evaluation of the last command in the unit test will determine the end result of the individual unit test. A test set is a group of unit tests with some association. A test campaign consists of one or more test sets. Test sets and unit tests can be given keywords to form logical groupings. When running a campaign, tests may be selected by keyword. This allows the user to run tests within a desired grouping.</p>
<p>For each unit test, test set and campaign, a CRC32 of the test is calculated and displayed as a signature of that test. This test signature is sufficient to determine that the actual test run was the one expected and not one that has been modified. In case your dealing with evil people that try to modify or corrupt the file without changing the CRC32, a global SHA1 is computed on the whole file.</p>
</div>
<div class="section" id="syntax-of-a-test-campaign">
<h3>Syntax of a Test Campaign<a class="headerlink" href="#syntax-of-a-test-campaign" title="Permalink to this headline">¶</a></h3>
<p>Table 1 shows the syntax indicators that UTScapy is looking for. The syntax specifier must appear as the first character of each line of the text file that defines the test. Text descriptions that follow the syntax specifier are arguments interpreted by UTScapy. Lines that appear without a leading syntax specifier will be treated as Python commands, provided they appear in the context of a unit test. Lines without a syntax specifier that appear outside the correct context will be rejected by UTScapy and a warning will be issued.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Syntax Specifier</th>
<th class="head">Definition</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>‘%’</td>
<td>Give the test campaign’s name.</td>
</tr>
<tr class="row-odd"><td>‘+’</td>
<td>Announce a new test set.</td>
</tr>
<tr class="row-even"><td>‘=’</td>
<td>Announce a new unit test.</td>
</tr>
<tr class="row-odd"><td>‘~’</td>
<td>Announce keywords for the current unit test.</td>
</tr>
<tr class="row-even"><td>‘*’</td>
<td>Denotes a comment that will be included in the report.</td>
</tr>
<tr class="row-odd"><td>‘#’</td>
<td>Testcase annotations that are discarded by the interpreter.</td>
</tr>
</tbody>
</table>
<p>Table 1 - UTScapy Syntax Specifiers</p>
<p>Comments placed in the test report have a context. Each comment will be associated to the last defined test container - be it a individual unit test, a test set or a test campaign. Multiple comments associated with a particular container will be concatenated together and will appear in the report directly after the test container announcement. General comments for a test file should appear before announcing a test campaign. For comments to be associated with a test campaign, they must appear after declaration of the test campaign but before any test set or unit test. Comments for a test set should appear before definition of the set’s first unit test.</p>
<p>The generic format for a test campaign is shown in the following table:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Test</span> <span class="n">Campaign</span> <span class="n">Name</span>
<span class="o">*</span> <span class="n">Comment</span> <span class="n">describing</span> <span class="n">this</span> <span class="n">campaign</span>


<span class="o">+</span> <span class="n">Test</span> <span class="n">Set</span> <span class="mi">1</span>
<span class="o">*</span> <span class="n">comments</span> <span class="k">for</span> <span class="n">test</span> <span class="nb">set</span> <span class="mi">1</span>

<span class="o">=</span> <span class="n">Unit</span> <span class="n">Test</span> <span class="mi">1</span>
<span class="o">~</span> <span class="n">keywords</span>
<span class="o">*</span> <span class="n">Comments</span> <span class="k">for</span> <span class="n">unit</span> <span class="n">test</span> <span class="mi">1</span>
<span class="c1"># Python statements follow</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">a</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Python statements are identified by the lack of a defined UTScapy syntax specifier. The Python statements are fed directly to the Python interpreter as if one is operating within the interactive Scapy shell (<code class="docutils literal"><span class="pre">interact</span></code>). Looping, iteration and conditionals are permissible but must be terminated by a blank line. A test set may be comprised of multiple unit tests and multiple test sets may be defined for each campaign. It is even possible to have multiple test campaigns in a particular test definition file. The use of keywords allows testing of subsets of the entire campaign. For example, during development of a test campaign, the user may wish to mark new tests under development with the keyword “debug”. Once the tests run successfully to their desired conclusion, the keyword “debug” could be removed. Keywords such as “regression” or “limited” could be used as well.</p>
<p>It is important to note that UTScapy uses the truth value from the last Python statement as the indicator as to whether a test passed or failed. Multiple logical tests may appear on the last line. If the result is 0 or False, the test fails. Otherwise, the test passes. Use of an assert() statement can force evaluation of intermediate values if needed.</p>
<p>The syntax for UTScapy is shown in Table 3 - UTScapy command line syntax:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@localhost</span> <span class="n">kamene</span><span class="p">]</span><span class="c1"># ./UTkamene.py –h</span>
<span class="n">Usage</span><span class="p">:</span> <span class="n">UTkamene</span> <span class="p">[</span><span class="o">-</span><span class="n">m</span> <span class="n">module</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span> <span class="p">{</span><span class="n">text</span><span class="o">|</span><span class="n">ansi</span><span class="o">|</span><span class="n">HTML</span><span class="o">|</span><span class="n">LaTeX</span><span class="p">}]</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="n">output_file</span><span class="p">]</span>
               <span class="p">[</span><span class="o">-</span><span class="n">t</span> <span class="n">testfile</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">k</span> <span class="n">keywords</span> <span class="p">[</span><span class="o">-</span><span class="n">k</span> <span class="o">...</span><span class="p">]]</span> <span class="p">[</span><span class="o">-</span><span class="n">K</span> <span class="n">keywords</span> <span class="p">[</span><span class="o">-</span><span class="n">K</span> <span class="o">...</span><span class="p">]]</span>
               <span class="p">[</span><span class="o">-</span><span class="n">l</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">d</span><span class="o">|-</span><span class="n">D</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">F</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="n">q</span><span class="p">]]</span>
<span class="o">-</span><span class="n">l</span>              <span class="p">:</span> <span class="n">generate</span> <span class="n">local</span> <span class="n">files</span>
<span class="o">-</span><span class="n">F</span>              <span class="p">:</span> <span class="n">expand</span> <span class="n">only</span> <span class="n">failed</span> <span class="n">tests</span>
<span class="o">-</span><span class="n">d</span>              <span class="p">:</span> <span class="n">dump</span> <span class="n">campaign</span>
<span class="o">-</span><span class="n">D</span>              <span class="p">:</span> <span class="n">dump</span> <span class="n">campaign</span> <span class="ow">and</span> <span class="n">stop</span>
<span class="o">-</span><span class="n">C</span>              <span class="p">:</span> <span class="n">don</span><span class="s1">&#39;t calculate CRC and SHA</span>
<span class="o">-</span><span class="n">q</span>              <span class="p">:</span> <span class="n">quiet</span> <span class="n">mode</span>
<span class="o">-</span><span class="n">qq</span>             <span class="p">:</span> <span class="p">[</span><span class="n">silent</span> <span class="n">mode</span><span class="p">]</span>
<span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">testnum</span><span class="o">&gt;</span>    <span class="p">:</span> <span class="n">only</span> <span class="n">tests</span> <span class="n">whose</span> <span class="n">numbers</span> <span class="n">are</span> <span class="n">given</span> <span class="p">(</span><span class="n">eg</span><span class="o">.</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="o">-</span><span class="n">m</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>     <span class="p">:</span> <span class="n">additional</span> <span class="n">module</span> <span class="n">to</span> <span class="n">put</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">namespace</span>
<span class="o">-</span><span class="n">k</span> <span class="o">&lt;</span><span class="n">kw1</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">kw2</span><span class="o">&gt;</span><span class="p">,</span><span class="o">...</span>      <span class="p">:</span> <span class="n">include</span> <span class="n">only</span> <span class="n">tests</span> <span class="k">with</span> <span class="n">one</span> <span class="n">of</span> <span class="n">those</span> <span class="n">keywords</span> <span class="p">(</span><span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">many</span> <span class="n">times</span><span class="p">)</span>
<span class="o">-</span><span class="n">K</span> <span class="o">&lt;</span><span class="n">kw1</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">kw2</span><span class="o">&gt;</span><span class="p">,</span><span class="o">...</span>      <span class="p">:</span> <span class="n">remove</span> <span class="n">tests</span> <span class="k">with</span> <span class="n">one</span> <span class="n">of</span> <span class="n">those</span> <span class="n">keywords</span> <span class="p">(</span><span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">many</span> <span class="n">times</span><span class="p">)</span>
</pre></div>
</div>
<p>Table 3 - UTScapy command line syntax</p>
<p>All arguments are optional. Arguments that have no associated argument value may be strung together (i.e. <code class="docutils literal"><span class="pre">–lqF</span></code>). If no testfile is specified, the test definition comes from &lt;STDIN&gt;. Similarly, if no output file is specified it is directed to &lt;STDOUT&gt;. The default output format is “ansi”. Table 4 lists the arguments, the associated argument value and their meaning to UTScapy.</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="14%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument</th>
<th class="head">Argument Value</th>
<th class="head">Meaning to UTScapy</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>-t</td>
<td>testfile</td>
<td>Input test file defining test campaign (default = &lt;STDIN&gt;)</td>
</tr>
<tr class="row-odd"><td>-o</td>
<td>output_file</td>
<td>File for output of test campaign results (default = &lt;STDOUT&gt;)</td>
</tr>
<tr class="row-even"><td>-f</td>
<td>test</td>
<td>ansi, HTML, LaTeX, Format out output report (default = ansi)</td>
</tr>
<tr class="row-odd"><td>-l</td>
<td>&#160;</td>
<td>Generate report associated files locally. For HTML, generates JavaScript
and the style sheet</td>
</tr>
<tr class="row-even"><td>-F</td>
<td>&#160;</td>
<td>Failed test cases will be initially expanded by default in HTML output</td>
</tr>
<tr class="row-odd"><td>-d</td>
<td>&#160;</td>
<td>Print a terse listing of the campaign before executing the campaign</td>
</tr>
<tr class="row-even"><td>-D</td>
<td>&#160;</td>
<td>Print a terse listing of the campaign and stop. Do not execute campaign</td>
</tr>
<tr class="row-odd"><td>-C</td>
<td>&#160;</td>
<td>Do not calculate test signatures</td>
</tr>
<tr class="row-even"><td>-q</td>
<td>&#160;</td>
<td>Do not update test progress to the screen as tests are executed</td>
</tr>
<tr class="row-odd"><td>-qq</td>
<td>&#160;</td>
<td>Silent mode</td>
</tr>
<tr class="row-even"><td>-n</td>
<td>testnum</td>
<td>Execute only those tests listed by number. Test numbers may be
retrieved using –d or –D. Tests may be listed as a comma
separated list and may include ranges (e.g. 1, 3-7, 12)</td>
</tr>
<tr class="row-odd"><td>-m</td>
<td>module</td>
<td>Load module before executing tests. Useful in testing derived works of Scapy.
Note: Derived works that are intended to execute as “__main__” will not be
invoked by UTScapy as “__main__”.</td>
</tr>
<tr class="row-even"><td>-k</td>
<td>kw1, kw2, …</td>
<td>Include only tests with keyword “kw1”. Multiple keywords may be specified.</td>
</tr>
<tr class="row-odd"><td>-K</td>
<td>kw1, kw2, …</td>
<td>Exclude tests with keyword “kw1”. Multiple keywords may be specified.</td>
</tr>
</tbody>
</table>
<p>Table 4 - UTScapy parameters</p>
<p>Table 5 shows a simple test campaign with multiple test set definitions. Additionally, keywords are specified that allow a limited number of test cases to be executed. Notice the use of the <code class="docutils literal"><span class="pre">assert()</span></code> statement in test 3 and 5 used to check intermediate results. Tests 2 and 5 will fail by design.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Example</span> <span class="n">Test</span> <span class="n">Campaign</span>

<span class="c1"># Comment describing this campaign</span>
<span class="c1">#</span>
<span class="c1"># To run this campaign, try:</span>
<span class="c1">#   ./UTkamene.py -t example_campaign.txt -f html -o example_campaign.html -F</span>
<span class="c1">#</span>

<span class="o">*</span> <span class="n">This</span> <span class="n">comment</span> <span class="ow">is</span> <span class="n">associated</span> <span class="k">with</span> <span class="n">the</span> <span class="n">test</span> <span class="n">campaign</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">appear</span>
<span class="o">*</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">produced</span> <span class="n">output</span><span class="o">.</span>

<span class="o">+</span> <span class="n">Test</span> <span class="n">Set</span> <span class="mi">1</span>

<span class="o">=</span> <span class="n">Unit</span> <span class="n">Test</span> <span class="mi">1</span>
<span class="o">~</span> <span class="n">test_set_1</span> <span class="n">simple</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="o">=</span> <span class="n">Unit</span> <span class="n">test</span> <span class="mi">2</span>
<span class="o">~</span> <span class="n">test_set_1</span> <span class="n">simple</span>
<span class="o">*</span> <span class="n">this</span> <span class="n">test</span> <span class="n">will</span> <span class="n">fail</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">a</span> <span class="o">==</span> <span class="n">b</span>

<span class="o">=</span> <span class="n">Unit</span> <span class="n">test</span> <span class="mi">3</span>
<span class="o">~</span> <span class="n">test_set_1</span> <span class="n">harder</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">)</span>
<span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;hello&quot;</span>

<span class="o">+</span> <span class="n">Test</span> <span class="n">Set</span> <span class="mi">2</span>

<span class="o">=</span> <span class="n">Unit</span> <span class="n">Test</span> <span class="mi">4</span>
<span class="o">~</span> <span class="n">test_set_2</span> <span class="n">harder</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">b</span>
<span class="n">d</span> <span class="ow">is</span> <span class="n">b</span>

<span class="o">=</span> <span class="n">Unit</span> <span class="n">Test</span> <span class="mi">5</span>
<span class="o">~</span> <span class="n">test_set_2</span> <span class="n">harder</span> <span class="n">hardest</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">d</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="n">d</span>
<span class="c1"># The following statement evaluates to False but is not last; continue</span>
<span class="n">e</span> <span class="o">==</span> <span class="mi">6</span>
<span class="c1"># assert evaluates to False; stop test and fail</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">e</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">e</span> <span class="o">==</span> <span class="mi">1296</span>

<span class="o">=</span> <span class="n">Unit</span> <span class="n">Test</span> <span class="mi">6</span>
<span class="o">~</span> <span class="n">test_set_2</span> <span class="n">hardest</span>
<span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="n">e</span> <span class="o">==</span> <span class="mi">1296</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Scapy development</a><ul>
<li><a class="reference internal" href="#project-organization">Project organization</a></li>
<li><a class="reference internal" href="#how-to-contribute">How to contribute</a></li>
<li><a class="reference internal" href="#testing-with-utscapy">Testing with UTScapy</a><ul>
<li><a class="reference internal" href="#what-is-utscapy">What is UTScapy?</a></li>
<li><a class="reference internal" href="#syntax-of-a-test-campaign">Syntax of a Test Campaign</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="troubleshooting.html" title="previous chapter">Troubleshooting</a></li>
      <li>Next: <a href="backmatter.html" title="next chapter">Credits</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/development.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2008, 2009 Philippe Biondi and the Scapy community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="_sources/development.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>