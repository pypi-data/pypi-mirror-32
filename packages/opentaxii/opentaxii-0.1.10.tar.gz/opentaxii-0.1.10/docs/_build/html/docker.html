
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Docker &#8212; OpenTAXII 0.1.10a1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Authentication and authorization" href="auth.html" />
    <link rel="prev" title="Running OpenTAXII" href="running.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="docker">
<h1>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h1>
<p>OpenTAXII can also be run using docker. This guide assumes that you have access to a local or remote docker server, and won’t go into the setup of docker.</p>
<p>To get a default (development) instance using docker</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ docker run -d -p <span class="m">9000</span>:9000 eclecticiq/opentaxii
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">OpenTAXII is now accessible through port 9000, with data stored locally in a SQLite database.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Configuration is done through environment variables.</p>
<p>Common configuration parameters are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">OPENTAXII_DOMAIN</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(optional)</span></dt>
<dd>This specifies under which domain the OpenTAXII server is available, default: <code class="docutils literal notranslate"><span class="pre">localhost:9000</span></code></dd>
</dl>
<hr class="docutils" />
<p>Setting up  authentication is done with the following two variables:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">OPENTAXII_USER</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(optional)</span></dt>
<dd>If the OpenTAXII user and password are not set, no authentication is required</dd>
<dt><code class="docutils literal notranslate"><span class="pre">OPENTAXII_PASS</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(optional)</span></dt>
<dd>If you don’t want to specify the password on the command line, it is possible to leave the definition empty, and Docker will pick up the value from the environment.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">OPENTAXII_SECRET</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(optional)</span></dt>
<dd>This is the secret with which the generated token is encoded.</dd>
</dl>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">OPENTAXII_PASS</span><span class="o">=</span><span class="s2">&quot;SomePassword&quot;</span>
$ docker run -d -p <span class="m">9000</span>:9000 -e <span class="nv">OPENTAXII_USER</span><span class="o">=</span>myuser -e OPENTAXII_PASS eclecticiq/opentaxii
</pre></div>
</div>
<hr class="docutils" />
<p>If you want to use a PostgreSQL database, instead of the included SQLite database, you can use the following environment variables for configuration:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">DATABASE_HOST</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(required)</span></dt>
<dd>This is the database host to connect to</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DATABASE_PORT</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(optional)</span></dt>
<dd>Default is <code class="docutils literal notranslate"><span class="pre">5432</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">DATABASE_USER</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(optional)</span></dt>
<dd>If not set, the default <code class="docutils literal notranslate"><span class="pre">postgres</span></code> is used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DATABASE_PASS</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(optional)</span></dt>
<dd>If not set, the database can be accessed by all containers on the same host!</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DATABASE_NAME</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(optional)</span></dt>
<dd>The database to use, by default uses <code class="docutils literal notranslate"><span class="pre">postgres</span></code></dd>
</dl>
<p>If you would like to use a different Database for authentication, you can also set the following variables (any variable not set, will use it’s regular DB counterpart):</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">AUTH_DATABASE_HOST</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(required)</span></dt>
<dd>This is the database host to connect to</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AUTH_DATABASE_PORT</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(optional)</span></dt>
<dd>Default is <code class="docutils literal notranslate"><span class="pre">5432</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">AUTH_DATABASE_USER</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(optional)</span></dt>
<dd>If not set, the default <code class="docutils literal notranslate"><span class="pre">postgres</span></code> is used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AUTH_DATABASE_PASS</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(optional)</span></dt>
<dd>If not set, the database can be accessed by all containers on the same host!</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AUTH_DATABASE_NAME</span></code> <span class="classifier-delimiter">:</span> <span class="classifier">(optional)</span></dt>
<dd>The database to use, by default uses <code class="docutils literal notranslate"><span class="pre">postgres</span></code></dd>
</dl>
</div>
<div class="section" id="volumes">
<h2>Volumes<a class="headerlink" href="#volumes" title="Permalink to this headline">¶</a></h2>
<p>This docker container exposes two volumes, which can be attached to a running instance:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">/data</span></code></dt>
<dd>This volume will contain the SQLite databases used by the default instance.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">/input</span></code></dt>
<dd>If you want to pre-load the running instance with <cite>services.yml</cite>, <cite>collections.yml</cite> or have your own <cite>opentaxii.yml</cite> configuration used for the running system, create a folder with these documents present.</dd>
</dl>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">pwd</span>
/some/path/examples
$ ls /some/path/examples
collections.yml services.yml
$ docker run -d -p <span class="m">9000</span>:9000 -v /some/path/examples:/input eclecticiq/opentaxii
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure your naming is correct. It will only execute actions when any of the files with names: <code class="docutils literal notranslate"><span class="pre">services.yml</span></code>, <code class="docutils literal notranslate"><span class="pre">collections.yml</span></code>, or <code class="docutils literal notranslate"><span class="pre">opentaxii.yml</span></code> are present.</p>
</div>
</div>
<div class="section" id="extending">
<h2>Extending<a class="headerlink" href="#extending" title="Permalink to this headline">¶</a></h2>
<p>If you need custom configuration, and installation of extra/custom code, it is better to extend the OpenTAXII docker image. For example, adding mysql (instead of PostgreSQL), and adding custom code, which is configured in a custom opentaxii.yml. The Dockerfile used will then look something like:</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span><span class="s"> eclecticiq/opentaxii:latest</span>
<span class="k">MAINTAINER</span><span class="s"> EclecticIQ &lt;opentaxii@eclecticiq.com&gt;</span>

<span class="k">RUN</span> pip install mysql-python <span class="se">\</span>
  <span class="o">&amp;&amp;</span> pip install custom-package

COPY opentaxii.yml /input/opentaxii.yml
</pre></div>
</div>
<p>And building the image is then done using:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ docker build -t eclecticiq/opentaxii-mysql .
</pre></div>
</div>
</div>
<div class="section" id="full-example-with-compose">
<h2>Full Example with Compose<a class="headerlink" href="#full-example-with-compose" title="Permalink to this headline">¶</a></h2>
<p>To see a full example of running OpenTAXII against a “real” database, using the <a class="reference external" href="https://docs.docker.com/compose/">docker-compose</a> tool, checkout the configuration at: <a class="reference external" href="https://raw.githubusercontent.com/EclecticIQ/OpenTAXII/master/examples/docker-compose.yml">examples/docker-compose.yml</a></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">db</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">postgres:9.4</span>
  <span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">POSTGRES_USER</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">user</span>
    <span class="l l-Scalar l-Scalar-Plain">POSTGRES_PASSWORD</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
    <span class="l l-Scalar l-Scalar-Plain">POSTGRES_DB</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">opentaxii</span>

<span class="l l-Scalar l-Scalar-Plain">opentaxii</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">eclecticiq/opentaxii</span>
  <span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">OPENTAXII_AUTH_SECRET</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">secret</span>
    <span class="l l-Scalar l-Scalar-Plain">OPENTAXII_DOMAIN</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.59.103:9000</span>
    <span class="l l-Scalar l-Scalar-Plain">OPENTAXII_USER</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">user1</span>
    <span class="l l-Scalar l-Scalar-Plain">OPENTAXII_PASS</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">pass1</span>
    <span class="l l-Scalar l-Scalar-Plain">DATABASE_HOST</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">db</span>
    <span class="l l-Scalar l-Scalar-Plain">DATABASE_NAME</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">opentaxii</span>
    <span class="l l-Scalar l-Scalar-Plain">DATABASE_USER</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">user</span>
    <span class="l l-Scalar l-Scalar-Plain">DATABASE_PASS</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./:/input:ro</span>
  <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">9000:9000</span>
  <span class="l l-Scalar l-Scalar-Plain">links</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">db:db</span>
</pre></div>
</div>
<p>This configuration starts two containers: <code class="docutils literal notranslate"><span class="pre">opentaxii</span></code> and <code class="docutils literal notranslate"><span class="pre">db</span></code>, creates the given collections and services, and adds a user for authentication.</p>
<p class="rubric">Next steps</p>
<p>Continue to <a class="reference internal" href="auth.html"><span class="doc">Authentication</span></a> page to learn how OpenTAXII authentication process works.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Docker</a><ul>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#volumes">Volumes</a></li>
<li><a class="reference internal" href="#extending">Extending</a></li>
<li><a class="reference internal" href="#full-example-with-compose">Full Example with Compose</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="running.html" title="previous chapter">Running OpenTAXII</a></li>
      <li>Next: <a href="auth.html" title="next chapter">Authentication and authorization</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, EclecticIQ.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>