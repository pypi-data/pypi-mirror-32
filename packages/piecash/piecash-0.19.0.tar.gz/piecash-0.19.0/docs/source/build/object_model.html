

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>GnuCash SQL Object model and schema &mdash; Python interface to GnuCash documents 0.15.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Python interface to GnuCash documents 0.15.0 documentation" href="index.html"/>
        <link rel="next" title="Resources" href="doc/resources.html"/>
        <link rel="prev" title="piecash.sa_extra module" href="api/piecash.sa_extra.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Python interface to GnuCash documents
          

          
          </a>

          
            
            
              <div class="version">
                0.15.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="news.html">What’s new</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="doc/doc.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial/index_existing.html">Tutorial : using existing objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial/index_new.html">Tutorial : creating new objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial/examples.html">Examples of programs written with piecash</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/comparison.html">piecash and the official python bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="android.html">piecash on android</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/piecash.html">piecash package</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">GnuCash SQL Object model and schema</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#schema">Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="#days-times-dates-datetimes">Days, times, dates &amp; datetimes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#core-objects">Core objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#book">Book</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fields">Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="#invariant">Invariant</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#commodity">Commodity</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Invariant</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#account">Account</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">Invariant</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#transaction-splits">Transaction &amp; Splits</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fields-for-transaction">Fields for Transaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fields-for-split">Fields for Split</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">Invariant</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#price">Price</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">Invariant</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="doc/resources.html">Resources</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python interface to GnuCash documents</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>GnuCash SQL Object model and schema</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/object_model.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="gnucash-sql-object-model-and-schema">
<h1>GnuCash SQL Object model and schema<a class="headerlink" href="#gnucash-sql-object-model-and-schema" title="Permalink to this headline">¶</a></h1>
<p>A clear documentation of the SQL schema (tables, columns, relationships) and the implicit semantic (invariants that should
be always satisfied, logic to apply in ambiguous/corner cases) is critical for piecash to</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>ensure data integrity (when creating new objects and/or modifying/deleting existing objects)</li>
<li>ensure compatibility in semantic with the official GnuCash application</li>
</ol>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This document explains what the author understands in these domains. It is not the reference documentation, please refer
to the official GnuCash documentation for this.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Disclaimer : piecash primary focus is on reading GnuCash books and creating new <a class="reference internal" href="#core-objects">Core objects</a>.
Creating other objects than the core objects, modifying existing objects attributes or relationships and deleting
objects can be done through piecash but at the user’s own risk (backup your books before doing any of such modifications)</p>
</div>
<div class="section" id="schema">
<h2>Schema<a class="headerlink" href="#schema" title="Permalink to this headline">¶</a></h2>
<p>The following SQL schema has been generated by sadisplay (<a class="reference external" href="https://pypi.python.org/pypi/sadisplay">https://pypi.python.org/pypi/sadisplay</a>) on a GnuCash book
generated by piecash on the MySQL backend with the option keep_foreign_keys (the official GnuCash schema does not define
foreign keys):</p>
<a class="reference internal image-reference" href="_images/schema.png"><img alt="_images/schema.png" src="_images/schema.png" style="width: 922.8px; height: 534.0px;" /></a>
</div>
<div class="section" id="days-times-dates-datetimes">
<h2>Days, times, dates &amp; datetimes<a class="headerlink" href="#days-times-dates-datetimes" title="Permalink to this headline">¶</a></h2>
<p>The use of date and time in GnuCash is somewhat complicated (mainly due to legacy reasons).
This chapter described how days and time are encoded in the different tables. For each table.field,
the DB type and the PIECASH type are given (DATE = day, DATETIME = day + time) as well as the representation
in SQL. All examples are based on a local time in CET (central european time) and for the 11 feb 2018.</p>
<dl class="docutils">
<dt>prices.date</dt>
<dd><div class="first last line-block">
<div class="line">DATETIME -&gt; DAY = YYYY-MM-DD 00:00:00 LT expressed as UTC (e.g. 20180210230000) if price entered via the price editor</div>
<div class="line">DATETIME -&gt; DAY = YYYY-MM-DD 10:59:00 UTC (e.g. 20180211105900) if price generated via a transaction</div>
<div class="line">DATETIME -&gt; DAY = ??? (To be completed)) if price retrieved via Finance:Quote</div>
</div>
</dd>
<dt>transactions.post_date</dt>
<dd>DATETIME -&gt; DAY = YYYY-MM-DD 10:59:00 UTC (e.g. 20180211105900)
In the slots, the date-posted stores the post_date as a day (e.g. 20180211)</dd>
<dt>transactions.enter_date</dt>
<dd>DATETIME -&gt; DATETIME = YYYY-MM-DD hh:mm:ss UTC (e.g. 20180211123036)</dd>
<dt>splits.reconcile_date</dt>
<dd>DATETIME -&gt; DAY = 1970-01-01 00:00:00 UTC if not applicable (19700101000000)
DATETIME -&gt; DAY = YYYY-MM-DD 23:59:59 LT expressed as UTC (e.g. 20180211225959)
In the slots, the reconcile-info/last-date stored and int64 representing the timestamp of the last post_date (e.g. 1518389999 ~ 20180211105900)</dd>
<dt>schedxactions.start_date, schedxactions.end_date, schedxactions.last_occur</dt>
<dd>DAY -&gt; DAY = YYYY-MM-DD</dd>
</dl>
</div>
<div class="section" id="core-objects">
<h2>Core objects<a class="headerlink" href="#core-objects" title="Permalink to this headline">¶</a></h2>
<p>There are 5 core objects in GnuCash  : <a class="reference internal" href="#book">Book</a>, <a class="reference internal" href="#commodity">Commodity</a>, <a class="reference internal" href="#account">Account</a>, <a class="reference internal" href="#transaction">Transaction</a>, <a class="reference internal" href="#split">Split</a>.
An additional object, the <a class="reference internal" href="#price">Price</a>, is strongly linked to the Commodity and is used in reports and for display (for instance, to convert all accounts balance
in the default currency). While not as core as the others, it is an essential piece of functionality for anyone using
GnuCash to track a stock portfolio value or multi-currency book.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A priori, all these objects are all “create once, never change” objects. Changing some fields of an object may lead to
complex renormalisation procedures. Deleting some objects may lead to complex cascade changes/renormalisation procedures.
In this respect, it is important to either avoid changes/deletions or to have clear invariants that should stay true at any time.</p>
</div>
<div class="section" id="book">
<h3>Book<a class="headerlink" href="#book" title="Permalink to this headline">¶</a></h3>
<p>The Book is the object model representing a GnuCash document. It has a link to the root account, the account at the
root of the tree structure.</p>
<div class="section" id="fields">
<h4>Fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>root_account (mandatory)</dt>
<dd>The account at the root of the tree structure</dd>
<dt>root_template (mandatory)</dt>
<dd>Use to attach split from template/scheduled transactions</dd>
</dl>
</div>
<div class="section" id="invariant">
<h4>Invariant<a class="headerlink" href="#invariant" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li>one (and only one) Book per GnuCash document</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="commodity">
<h3>Commodity<a class="headerlink" href="#commodity" title="Permalink to this headline">¶</a></h3>
<p>A Commodity is either a currency (€, $, …) or a commodity/stock that can be stored in/traded through an Account.</p>
<p>The Commodity object is used in two different (but related) contexts.</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>each Account should specify the Commodity it handles/stores. For usual accounts (Savings, Expenses, etc), the Commodity
is a currency. For trading accounts, the Commodity is usually a stock (AMZN, etc).
In this role, each commodity (be it a stock or a currency) can have Prices attached to it that give the value of the
commodity expressed in a given currency.</li>
<li>each Transaction should specify the Currency which is used to balance itself.</li>
</ol>
</div></blockquote>
<div class="section" id="id1">
<h4>Fields<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>namespace (mandatory)</dt>
<dd>A string representing the group/class of the commodity. All commodities that are currencies should have ‘CURRENCY’ as
namespace. Non currency commodities should have other groups.</dd>
<dt>mnemonic (mandatory)</dt>
<dd>The symbol/stock sticker of the commodity (relevant for online download of quotes)</dd>
<dt>fullname</dt>
<dd>The full name for the commodity. Besides the fullname, there is a “calculated property” unique_name equal to “namespace::mnemonic”</dd>
<dt>cusip</dt>
<dd>unique code for the commodity</dd>
<dt>fraction</dt>
<dd>The smallest unit that can be accounted for (for a currency, this is equivalent to the scu, the smallest currency unit)
This is essentially used for a) display and b) roundings</dd>
<dt>quote_flag</dt>
<dd>True if Prices for the commodity should be retrieved for the given stock. This is used by the “quote download” functionnality.</dd>
<dt>quote_source</dt>
<dd>The source for online download of quotes</dd>
</dl>
</div>
<div class="section" id="id2">
<h4>Invariant<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li>a currency commodity has namespace==’CURRENCY’</li>
<li>only currencies referenced by accounts or commodities are stored in the table ‘commodities’ (the complete list of
currencies is available within the GnuCash application)</li>
<li>a stock commodity has namespace!=’CURRENCY’</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="account">
<h3>Account<a class="headerlink" href="#account" title="Permalink to this headline">¶</a></h3>
<p>An account tracks some commodity for some business purpose. Changes in the commodity amounts are modelled through Splits
(see Transaction &amp; Splits).</p>
<div class="section" id="id3">
<h4>Fields<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>type (mandatory)</dt>
<dd>the type of the account as string</dd>
<dt>commodity (mandatory)</dt>
<dd>The commodity that is handled by the account</dd>
<dt>parent (almost mandatory)</dt>
<dd>the parent account to which the account is attached. All accounts but the root_account should have a parent account.</dd>
<dt>commodity_scu (mandatory)</dt>
<dd>The smallest currency/commodity unit is similar to the fraction of a commodity. It is the smallest amount of the commodity
that is tracked in the account. If it is different than the fraction of the commodity to which the account is linked,
the field non_std_scu is set to 1 (otherwise the latter is set to 0).</dd>
<dt>name</dt>
<dd>self-explanatory</dd>
<dt>description</dt>
<dd>self-explanatory</dd>
<dt>placeholder</dt>
<dd>if True/1, the account cannot be involved in transactions through splits (ie it can only be the parent of other accounts).
if False/0, the account can have Splits referring to it (as well as be the parent of other accounts).
This field, if True, is also stored as a Slot under the key “placeholder” as a string “true”.</dd>
<dt>hidden</dt>
<dd>if True/1, the account will not be displayed in the GnuCash GUI Accounts tab and can be easily excluded from GnuCash GUI Reports.
if False/0, the account will be displayed in the GnuCash GUI Accounts tab.</dd>
</dl>
</div>
<div class="section" id="id4">
<h4>Invariant<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li>if placeholder, no new splits can be created/changed (like a “freeze”)</li>
<li>only two accounts can have type ROOT (the root_account and the root_template of the book).</li>
<li>the type of an account is constrained by the type of the parent account</li>
<li>trading account are used when the option “use trading accounts” is enabled</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="transaction-splits">
<span id="split"></span><span id="transaction"></span><h3>Transaction &amp; Splits<a class="headerlink" href="#transaction-splits" title="Permalink to this headline">¶</a></h3>
<p>The transaction represents movement of money between accounts expressed in a given currency (the currency of the transaction).
The transaction is modelled through a set of Splits (2 or more).
Each Split is linked to an Account and gives the increase/decrease in units of the account commodity (quantity)
related to the transaction as well as the equivalent amount in currency (value).
For a given transaction, the sum of the split expressed in the currency (value) should be balanced.</p>
<div class="section" id="fields-for-transaction">
<h4>Fields for Transaction<a class="headerlink" href="#fields-for-transaction" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>currency (mandatory)</dt>
<dd>The currency of the transaction</dd>
<dt>num (optional)</dt>
<dd>A transaction number (only used for information)</dd>
<dt>post_date (mandatory)</dt>
<dd>self-explanatory. This field is also stored as a slot under the date-posted key (as a date instead of a time)</dd>
<dt>enter_date (mandatory)</dt>
<dd>self-explanatory</dd>
<dt>description (mandatory)</dt>
<dd>self-explanatory</dd>
</dl>
</div>
<div class="section" id="fields-for-split">
<h4>Fields for Split<a class="headerlink" href="#fields-for-split" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>tx (mandatory)</dt>
<dd>the transaction of the split</dd>
<dt>account (mandatory)</dt>
<dd>the account to which the split refers to</dd>
<dt>value (mandatory)</dt>
<dd>the value of the split expressed in the currency of the transaction</dd>
<dt>quantity (mandatory)</dt>
<dd>the change in quantity of the account expressed in the commodity of the account</dd>
<dt>reconcile information</dt>
<dd><p class="first">(Descriptions from official help manual.)</p>
<ul class="last simple">
<li>n - Default status when a transaction is created</li>
<li>c - Cleared. Status may be assigned either manually or by an import process.</li>
<li>y - Status assigned solely by the reconciliation process. Places limits optionally requiring confirmation on editing fields in that line of a transaction.</li>
<li>f - Frozen. Not implemented at this time</li>
<li>v - Voided. Status is assigned or released manually and applies to every line in the transaction. It hides most of the transaction details but does not delete them. When a transaction is voided a reason entry is required that appears to the right of the description. (Note: There appears to be no way to actually view the reason in the GnuCash GUI at the moment.)</li>
</ul>
</dd>
<dt>lot</dt>
<dd>reference to the lot (to be investigated)</dd>
</dl>
</div>
<div class="section" id="id5">
<h4>Invariant<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li>the sum of the value on all splits in a transaction should = 0 (transaction is balanced). If it is not the case, the
GnuCash application create automatically an extra Split entry towards the Account Imbalance-XXX (with XXX the currency
of the transaction)</li>
<li>the value and quantity fields are expressed as numerator / denominator. The denominator of the value should be
the same as the fraction of the currency. The denominator of the quantity should be the same as the commodity_scu of
the account.</li>
<li>the currency of a transaction is the currency of the account into which it is created in the GUI</li>
<li>if “use trading accounts” is enabled then the sum of quantities per commodity should also be balanced. This is done thanks
to the automatic creation of splits with trading accounts (of type TRADING)</li>
<li>the reconcile field in all splits in a transaction that is voided are set to v</li>
<li>a voided transaction has 4 associated slots with obj_guid equal to the transaction’s guid and slot_type 4:<ul>
<li>name: notes, string_val: Voided transaction</li>
<li>name: trans-read-only, string_val: Transaction Voided</li>
<li>name: void-reason, string_val: &lt;user-supplied reason string&gt;</li>
<li>name: void-time, string_val: date as string in format <code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD</span> <span class="pre">HH:mm:ss.nnnnnn</span> <span class="pre">pZZZZ</span></code> where n represents milliseconds, p is an optionally present minus sign, and ZZZZ is GMT offset in HHmm format.</li>
</ul>
</li>
<li>a voided split has 2 nearly identical associated slots with obj_guid equal to the split’s guid and slot_type 3:<ul>
<li>name: void-former-amount, numeric_val_num/numeric_val_denom: the value of the voided split</li>
<li>name: void-former-value, numeric_val_num/numeric_val_denom: the value of the voided split</li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="price">
<h3>Price<a class="headerlink" href="#price" title="Permalink to this headline">¶</a></h3>
<p>The Price represent the value of a commodity in a given currency at some time.</p>
<p>It is used for exchange rates and stock valuation.</p>
<div class="section" id="id6">
<h4>Fields<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>commodity (mandatory)</dt>
<dd>the commodity related to the Price</dd>
<dt>currency (mandatory)</dt>
<dd>The currency of the Price</dd>
<dt>date (mandatory)</dt>
<dd>self-explanatory (expressed in UTC)</dd>
<dt>value (mandatory)</dt>
<dd>the value in currency of the commodity</dd>
</dl>
</div>
<div class="section" id="id7">
<h4>Invariant<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li>the value is expressed as numerator / denominator. The denominator of the value should be
the same as the fraction of the currency.</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="doc/resources.html" class="btn btn-neutral float-right" title="Resources" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api/piecash.sa_extra.html" class="btn btn-neutral" title="piecash.sa_extra module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014 sdementen.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.15.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>