

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Examples of programs written with piecash &mdash; Python interface to GnuCash documents 0.15.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Python interface to GnuCash documents 0.15.0 documentation" href="../index.html"/>
        <link rel="next" title="piecash and the official python bindings" href="../doc/comparison.html"/>
        <link rel="prev" title="Tutorial : creating new objects" href="index_new.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Python interface to GnuCash documents
          

          
          </a>

          
            
            
              <div class="version">
                0.15.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../news.html">What’s new</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../doc/doc.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="index_existing.html">Tutorial : using existing objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="index_new.html">Tutorial : creating new objects</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples of programs written with piecash</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-and-opening-gnucash-files">Creating and opening gnucash files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-account">Creating an account</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-transaction">Creating a transaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simple-changes-on-a-newly-created-book">Simple changes on a newly created book</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-a-book-with-some-accounts-and-add-a-transaction">Create a book with some accounts and add a transaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extract-split-information-as-pandas-dataframe">Extract Split information as pandas DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="#filtered-transaction-reports">Filtered transaction reports</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../doc/comparison.html">piecash and the official python bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../android.html">piecash on android</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/piecash.html">piecash package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../object_model.html">GnuCash SQL Object model and schema</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../doc/resources.html">Resources</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Python interface to GnuCash documents</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Examples of programs written with piecash</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorial/examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="examples-of-programs-written-with-piecash">
<h1>Examples of programs written with piecash<a class="headerlink" href="#examples-of-programs-written-with-piecash" title="Permalink to this headline">¶</a></h1>
<p>You can find examples of programs/scripts (loosely based on the scripts for the
official python bindings for gnucash or on
questions posted on the mailing list) in the examples subfolder.</p>
<div class="section" id="creating-and-opening-gnucash-files">
<h2>Creating and opening gnucash files<a class="headerlink" href="#creating-and-opening-gnucash-files" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="kn">from</span> <span class="nn">piecash</span> <span class="k">import</span> <span class="n">open_book</span><span class="p">,</span> <span class="n">create_book</span><span class="p">,</span> <span class="n">GnucashException</span>


<span class="n">FILE_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span> <span class="s2">&quot;not_there.gnucash&quot;</span><span class="p">)</span>
<span class="n">FILE_2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span> <span class="s2">&quot;example_file.gnucash&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">FILE_2</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">FILE_2</span><span class="p">)</span>

<span class="c1"># open a file that isn&#39;t there, detect the error</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">book</span> <span class="o">=</span> <span class="n">open_book</span><span class="p">(</span><span class="n">FILE_1</span><span class="p">)</span>
<span class="k">except</span> <span class="n">GnucashException</span> <span class="k">as</span> <span class="n">backend_exception</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK&quot;</span><span class="p">,</span> <span class="n">backend_exception</span><span class="p">)</span>

<span class="c1"># create a new file, this requires a file type specification</span>
<span class="k">with</span> <span class="n">create_book</span><span class="p">(</span><span class="n">FILE_2</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="c1"># open the new file, try to open it a second time, detect the lock</span>
<span class="c1"># using the session as context manager automatically release the lock and close the session</span>
<span class="k">with</span> <span class="n">open_book</span><span class="p">(</span><span class="n">FILE_2</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">open_book</span><span class="p">(</span><span class="n">FILE_2</span><span class="p">)</span> <span class="k">as</span> <span class="n">book_2</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">except</span> <span class="n">GnucashException</span> <span class="k">as</span> <span class="n">backend_exception</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK&quot;</span><span class="p">,</span> <span class="n">backend_exception</span><span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">FILE_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-an-account">
<h2>Creating an account<a class="headerlink" href="#creating-an-account" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">##  @file</span>
<span class="c1">#   @brief Example Script simple sqlite create</span>
<span class="c1">#   @ingroup python_bindings_examples</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">piecash</span> <span class="k">import</span> <span class="n">create_book</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">Commodity</span><span class="p">,</span> <span class="n">open_book</span>
<span class="kn">from</span> <span class="nn">piecash.core.factories</span> <span class="k">import</span> <span class="n">create_currency_from_ISO</span>

<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;test.blob&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="k">with</span> <span class="n">create_book</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">book</span><span class="o">.</span><span class="n">root_account</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;wow&quot;</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;ASSET&quot;</span><span class="p">,</span>
                <span class="n">commodity</span><span class="o">=</span><span class="n">create_currency_from_ISO</span><span class="p">(</span><span class="s2">&quot;CAD&quot;</span><span class="p">))</span>

    <span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="k">with</span> <span class="n">open_book</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">root_account</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">commodities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mnemonic</span><span class="o">=</span><span class="s2">&quot;CAD&quot;</span><span class="p">))</span>

<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-transaction">
<h2>Creating a transaction<a class="headerlink" href="#creating-a-transaction" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># # @file</span>
<span class="c1"># @brief Creates a basic set of accounts and a couple of transactions</span>
<span class="c1"># @ingroup python_bindings_examples</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="k">import</span> <span class="n">Decimal</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="kn">from</span> <span class="nn">piecash</span> <span class="k">import</span> <span class="n">create_book</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">,</span> <span class="n">Split</span><span class="p">,</span> <span class="n">Commodity</span>
<span class="kn">from</span> <span class="nn">piecash.core.factories</span> <span class="k">import</span> <span class="n">create_currency_from_ISO</span>

<span class="n">FILE_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span> <span class="s2">&quot;example.gnucash&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">create_book</span><span class="p">(</span><span class="n">FILE_1</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">root_acct</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">root_account</span>
    <span class="n">cad</span> <span class="o">=</span> <span class="n">create_currency_from_ISO</span><span class="p">(</span><span class="s2">&quot;CAD&quot;</span><span class="p">)</span>
    <span class="n">expenses_acct</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">root_acct</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Expenses&quot;</span><span class="p">,</span>
                            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;EXPENSE&quot;</span><span class="p">,</span>
                            <span class="n">commodity</span><span class="o">=</span><span class="n">cad</span><span class="p">)</span>
    <span class="n">savings_acct</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">root_acct</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Savings&quot;</span><span class="p">,</span>
                           <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;BANK&quot;</span><span class="p">,</span>
                           <span class="n">commodity</span><span class="o">=</span><span class="n">cad</span><span class="p">)</span>
    <span class="n">opening_acct</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">root_acct</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Opening Balance&quot;</span><span class="p">,</span>
                           <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;EQUITY&quot;</span><span class="p">,</span>
                           <span class="n">commodity</span><span class="o">=</span><span class="n">cad</span><span class="p">)</span>
    <span class="n">num1</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;4&quot;</span><span class="p">)</span>
    <span class="n">num2</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;100&quot;</span><span class="p">)</span>
    <span class="n">num3</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;15&quot;</span><span class="p">)</span>

    <span class="c1"># create transaction with core objects in one step</span>
    <span class="n">trans1</span> <span class="o">=</span> <span class="n">Transaction</span><span class="p">(</span><span class="n">currency</span><span class="o">=</span><span class="n">cad</span><span class="p">,</span>
                         <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Groceries&quot;</span><span class="p">,</span>
                         <span class="n">splits</span><span class="o">=</span><span class="p">[</span>
                             <span class="n">Split</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">num1</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">expenses_acct</span><span class="p">),</span>
                             <span class="n">Split</span><span class="p">(</span><span class="n">value</span><span class="o">=-</span><span class="n">num1</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">savings_acct</span><span class="p">),</span>
                         <span class="p">])</span>

    <span class="c1"># create transaction with core object in multiple steps</span>
    <span class="n">trans2</span> <span class="o">=</span> <span class="n">Transaction</span><span class="p">(</span><span class="n">currency</span><span class="o">=</span><span class="n">cad</span><span class="p">,</span>
                         <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Opening Savings Balance&quot;</span><span class="p">)</span>

    <span class="n">split3</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">num2</span><span class="p">,</span>
                   <span class="n">account</span><span class="o">=</span><span class="n">savings_acct</span><span class="p">,</span>
                   <span class="n">transaction</span><span class="o">=</span><span class="n">trans2</span><span class="p">)</span>

    <span class="n">split4</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="n">value</span><span class="o">=-</span><span class="n">num2</span><span class="p">,</span>
                   <span class="n">account</span><span class="o">=</span><span class="n">opening_acct</span><span class="p">,</span>
                   <span class="n">transaction</span><span class="o">=</span><span class="n">trans2</span><span class="p">)</span>

    <span class="c1"># create transaction with factory function</span>
    <span class="kn">from</span> <span class="nn">piecash.core.factories</span> <span class="k">import</span> <span class="n">single_transaction</span>
    <span class="n">trans3</span> <span class="o">=</span> <span class="n">single_transaction</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Pharmacy&quot;</span><span class="p">,</span> <span class="n">num3</span><span class="p">,</span> <span class="n">savings_acct</span><span class="p">,</span> <span class="n">expenses_acct</span><span class="p">)</span>

    <span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>


</pre></div>
</div>
</div>
<div class="section" id="simple-changes-on-a-newly-created-book">
<h2>Simple changes on a newly created book<a class="headerlink" href="#simple-changes-on-a-newly-created-book" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">piecash</span> <span class="k">import</span> <span class="n">create_book</span>

<span class="c1"># create by default an in memory sqlite version</span>
<span class="n">book</span> <span class="o">=</span> <span class="n">create_book</span><span class="p">(</span><span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Book is saved:&quot;</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">is_saved</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ==&gt; book description:&quot;</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">root_account</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;changing description...&quot;</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">root_account</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;hello, book&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Book is saved:&quot;</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">is_saved</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ==&gt; book description:&quot;</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">root_account</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;saving...&quot;</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Book is saved:&quot;</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">is_saved</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ==&gt; book description:&quot;</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">root_account</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;changing description...&quot;</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">root_account</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;nevermind, book&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Book is saved:&quot;</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">is_saved</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ==&gt; book description:&quot;</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">root_account</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cancel...&quot;</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Book is saved:&quot;</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">is_saved</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ==&gt; book description:&quot;</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">root_account</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-book-with-some-accounts-and-add-a-transaction">
<h2>Create a book with some accounts and add a transaction<a class="headerlink" href="#create-a-book-with-some-accounts-and-add-a-transaction" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">piecash</span> <span class="k">import</span> <span class="n">create_book</span><span class="p">,</span> <span class="n">Account</span>

<span class="c1"># create a book with some account tree structure</span>
<span class="k">with</span> <span class="n">create_book</span><span class="p">(</span><span class="s2">&quot;../gnucash_books/simple_book_transaction_creation.gnucash&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">mybook</span><span class="p">:</span>
    <span class="n">mybook</span><span class="o">.</span><span class="n">root_account</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Account</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Expenses&quot;</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;EXPENSE&quot;</span><span class="p">,</span>
                <span class="n">commodity</span><span class="o">=</span><span class="n">mybook</span><span class="o">.</span><span class="n">currencies</span><span class="p">(</span><span class="n">mnemonic</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">),</span>
                <span class="n">placeholder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">children</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">Account</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Some Expense Account&quot;</span><span class="p">,</span>
                            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;EXPENSE&quot;</span><span class="p">,</span>
                            <span class="n">commodity</span><span class="o">=</span><span class="n">mybook</span><span class="o">.</span><span class="n">currencies</span><span class="p">(</span><span class="n">mnemonic</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)),</span>
                <span class="p">]),</span>
        <span class="n">Account</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Assets&quot;</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;ASSET&quot;</span><span class="p">,</span>
                <span class="n">commodity</span><span class="o">=</span><span class="n">mybook</span><span class="o">.</span><span class="n">currencies</span><span class="p">(</span><span class="n">mnemonic</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">),</span>
                <span class="n">placeholder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">children</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">Account</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Current Assets&quot;</span><span class="p">,</span>
                            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;BANK&quot;</span><span class="p">,</span>
                            <span class="n">commodity</span><span class="o">=</span><span class="n">mybook</span><span class="o">.</span><span class="n">currencies</span><span class="p">(</span><span class="n">mnemonic</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">),</span>
                            <span class="n">placeholder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">children</span><span class="o">=</span><span class="p">[</span>
                                <span class="n">Account</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Checking&quot;</span><span class="p">,</span>
                                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;BANK&quot;</span><span class="p">,</span>
                                        <span class="n">commodity</span><span class="o">=</span><span class="n">mybook</span><span class="o">.</span><span class="n">currencies</span><span class="p">(</span><span class="n">mnemonic</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">))</span>
                            <span class="p">]),</span>
                <span class="p">]),</span>
    <span class="p">]</span>
    <span class="c1"># save the book</span>
    <span class="n">mybook</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">piecash</span> <span class="k">import</span> <span class="n">open_book</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">,</span> <span class="n">Split</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="k">import</span> <span class="n">Decimal</span>

<span class="c1"># reopen the book and add a transaction</span>
<span class="k">with</span> <span class="n">open_book</span><span class="p">(</span><span class="s2">&quot;../gnucash_books/simple_book_transaction_creation.gnucash&quot;</span><span class="p">,</span>
               <span class="n">open_if_lock</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">mybook</span><span class="p">:</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="c1"># retrieve the currency from the book</span>
    <span class="n">USD</span> <span class="o">=</span> <span class="n">mybook</span><span class="o">.</span><span class="n">currencies</span><span class="p">(</span><span class="n">mnemonic</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)</span>
    <span class="c1"># define the amount as Decimal</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;25.35&quot;</span><span class="p">)</span>
    <span class="c1"># retrieve accounts</span>
    <span class="n">to_account</span> <span class="o">=</span> <span class="n">mybook</span><span class="o">.</span><span class="n">accounts</span><span class="p">(</span><span class="n">fullname</span><span class="o">=</span><span class="s2">&quot;Expenses:Some Expense Account&quot;</span><span class="p">)</span>
    <span class="n">from_account</span> <span class="o">=</span> <span class="n">mybook</span><span class="o">.</span><span class="n">accounts</span><span class="p">(</span><span class="n">fullname</span><span class="o">=</span><span class="s2">&quot;Assets:Current Assets:Checking&quot;</span><span class="p">)</span>
    <span class="c1"># create the transaction with its two splits</span>
    <span class="n">Transaction</span><span class="p">(</span>
        <span class="n">post_date</span><span class="o">=</span><span class="n">today</span><span class="p">,</span>
        <span class="n">enter_date</span><span class="o">=</span><span class="n">today</span><span class="p">,</span>
        <span class="n">currency</span><span class="o">=</span><span class="n">USD</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Transaction Description!&quot;</span><span class="p">,</span>
        <span class="n">splits</span><span class="o">=</span><span class="p">[</span>
            <span class="n">Split</span><span class="p">(</span><span class="n">account</span><span class="o">=</span><span class="n">to_account</span><span class="p">,</span>
                  <span class="n">value</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
                  <span class="n">memo</span><span class="o">=</span><span class="s2">&quot;Split Memo!&quot;</span><span class="p">),</span>
            <span class="n">Split</span><span class="p">(</span><span class="n">account</span><span class="o">=</span><span class="n">from_account</span><span class="p">,</span>
                  <span class="n">value</span><span class="o">=-</span><span class="n">amount</span><span class="p">,</span>
                  <span class="n">memo</span><span class="o">=</span><span class="s2">&quot;Other Split Memo!&quot;</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># save the book</span>
    <span class="n">mybook</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">piecash</span> <span class="k">import</span> <span class="n">ledger</span>

<span class="c1"># check the book by exporting to ledger format</span>
<span class="k">with</span> <span class="n">open_book</span><span class="p">(</span><span class="s2">&quot;../gnucash_books/simple_book_transaction_creation.gnucash&quot;</span><span class="p">,</span>
               <span class="n">open_if_lock</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">mybook</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ledger</span><span class="p">(</span><span class="n">mybook</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="extract-split-information-as-pandas-dataframe">
<h2>Extract Split information as pandas DataFrame<a class="headerlink" href="#extract-split-information-as-pandas-dataframe" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">piecash</span> <span class="k">import</span> <span class="n">open_book</span>

<span class="c1"># open a book</span>
<span class="k">with</span> <span class="n">open_book</span><span class="p">(</span><span class="s2">&quot;../gnucash_books/simple_sample.gnucash&quot;</span><span class="p">,</span> <span class="n">open_if_lock</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">mybook</span><span class="p">:</span>
    <span class="c1"># print all splits in account &quot;Asset&quot;</span>
    <span class="n">asset</span> <span class="o">=</span> <span class="n">mybook</span><span class="o">.</span><span class="n">accounts</span><span class="p">(</span><span class="n">fullname</span><span class="o">=</span><span class="s2">&quot;Asset&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">asset</span><span class="o">.</span><span class="n">splits</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>

    <span class="c1"># extract all split information to a pandas DataFrame</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">mybook</span><span class="o">.</span><span class="n">splits_df</span><span class="p">()</span>

    <span class="c1"># print for account &quot;Asset&quot; some information on the splits</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;account.fullname&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Asset&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;transaction.post_date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="section" id="filtered-transaction-reports">
<h2>Filtered transaction reports<a class="headerlink" href="#filtered-transaction-reports" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">from</span> <span class="nn">piecash</span> <span class="k">import</span> <span class="n">open_book</span>


<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">this_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">open_book</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">this_folder</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;gnucash_books&quot;</span><span class="p">,</span> <span class="s2">&quot;simple_sample.gnucash&quot;</span><span class="p">),</span> <span class="n">open_if_lock</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">open_book</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;gnucash_books&quot;</span><span class="p">,</span> <span class="s2">&quot;simple_sample.gnucash&quot;</span><span class="p">),</span> <span class="n">open_if_lock</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># get default currency</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">default_currency</span><span class="p">)</span>

<span class="n">regex_filter</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^/Rental/&quot;</span><span class="p">)</span>

<span class="c1"># retrieve relevant transactions</span>
<span class="n">transactions</span> <span class="o">=</span> <span class="p">[</span><span class="n">tr</span> <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">transactions</span>  <span class="c1"># query all transactions in the book/session and filter them on</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">regex_filter</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>  <span class="c1"># description field matching regex</span>
                    <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">regex_filter</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">spl</span><span class="o">.</span><span class="n">memo</span><span class="p">)</span> <span class="k">for</span> <span class="n">spl</span> <span class="ow">in</span> <span class="n">tr</span><span class="o">.</span><span class="n">splits</span><span class="p">))</span>  <span class="c1"># or memo field of any split of transaction</span>
                <span class="ow">and</span> <span class="n">tr</span><span class="o">.</span><span class="n">post_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>  <span class="c1"># and with post_date no later than begin nov.</span>


<span class="c1"># output report with simple &#39;print&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Here are the transactions for the search criteria &#39;</span><span class="si">{}</span><span class="s2">&#39;:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">regex_filter</span><span class="o">.</span><span class="n">pattern</span><span class="p">))</span>
<span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">transactions</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- {:%Y/%m/</span><span class="si">%d</span><span class="s2">} : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">post_date</span><span class="p">,</span> <span class="n">tr</span><span class="o">.</span><span class="n">description</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">spl</span> <span class="ow">in</span> <span class="n">tr</span><span class="o">.</span><span class="n">splits</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{amount}</span><span class="s2">  </span><span class="si">{direction}</span><span class="s2">  </span><span class="si">{account}</span><span class="s2"> : </span><span class="si">{memo}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">spl</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                                                                   <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;--&gt;&quot;</span> <span class="k">if</span> <span class="n">spl</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&lt;--&quot;</span><span class="p">,</span>
                                                                   <span class="n">account</span><span class="o">=</span><span class="n">spl</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">fullname</span><span class="p">,</span>
                                                                   <span class="n">memo</span><span class="o">=</span><span class="n">spl</span><span class="o">.</span><span class="n">memo</span><span class="p">))</span>

<span class="c1"># same with jinja2 templates</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">jinja2</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">*** Install jinja2 (&#39;pip install jinja2&#39;) to test the jinja2 template version ***</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">jinja2</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="n">jinja2</span><span class="p">:</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span><span class="n">trim_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lstrip_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Here are the transactions for the search criteria &#39;{{regex.pattern}}&#39;:</span>
<span class="s2">    {</span><span class="si">% f</span><span class="s2">or tr in transactions %}</span>
<span class="s2">    - {{ tr.post_date.strftime(&quot;%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;) }} : {{ tr.description }}</span>
<span class="s2">      {</span><span class="si">% f</span><span class="s2">or spl in tr.splits %}</span>
<span class="s2">        {{ spl.value.__abs__() }} {</span><span class="si">% i</span><span class="s2">f spl.value &lt; 0 %} --&gt; {</span><span class="si">% e</span><span class="s2">lse %} &lt;-- {</span><span class="si">% e</span><span class="s2">ndif %} {{ spl.account.fullname }} : {{ spl.memo }}</span>
<span class="s2">      {</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">    {</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">transactions</span><span class="o">=</span><span class="n">transactions</span><span class="p">,</span>
                <span class="n">regex</span><span class="o">=</span><span class="n">regex_filter</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../doc/comparison.html" class="btn btn-neutral float-right" title="piecash and the official python bindings" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index_new.html" class="btn btn-neutral" title="Tutorial : creating new objects" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014 sdementen.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.15.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>