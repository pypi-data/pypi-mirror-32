<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Signals &#8212; Flask Dance 0.14.0 documentation</title>
    
    <link rel="stylesheet" href="_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.14.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How OAuth Works" href="how-oauth-works.html" />
    <link rel="prev" title="Proxies and HTTPS" href="proxies.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="how-oauth-works.html" title="How OAuth Works"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="proxies.html" title="Proxies and HTTPS"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Flask Dance 0.14.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <span class="target" id="module-flask_dance.consumer"></span><div class="section" id="signals">
<h1>Signals<a class="headerlink" href="#signals" title="Permalink to this headline">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.2.</span></p>
</div>
<p>Flask-Dance supports signals, <span class="xref std std-ref">just as Flask does</span>.
Signals are perfect for custom processing code that you want to run at a certain
point in the OAuth dance. For example, after the dance is complete, you might
need to update the user&#8217;s profile, kick off a long-running task, or simply
<span class="xref std std-ref">flash a message</span> to let the user know
that the login was successful. It&#8217;s easy, just import the appropriate signal of
the ones listed below, and connect your custom processing code to the signal.</p>
<p>The following signals exist in Flask-Dance:</p>
<dl class="data">
<dt id="flask_dance.consumer.oauth_authorized">
<code class="descclassname">flask_dance.consumer.</code><code class="descname">oauth_authorized</code><a class="headerlink" href="#flask_dance.consumer.oauth_authorized" title="Permalink to this definition">¶</a></dt>
<dd><p>This signal is sent when a user completes the OAuth dance by receiving a
response from the OAuth provider&#8217;s authorize URL. The signal is invoked
with the blueprint instance as the first argument (the <em>sender</em>), and with
a dict of the OAuth provider&#8217;s response (the <em>token</em>).</p>
<p>Example subscriber:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">flash</span>
<span class="kn">from</span> <span class="nn">flask_dance.consumer</span> <span class="k">import</span> <span class="n">oauth_authorized</span>

<span class="nd">@oauth_authorized</span><span class="o">.</span><span class="n">connect</span>
<span class="k">def</span> <span class="nf">logged_in</span><span class="p">(</span><span class="n">blueprint</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Signed in successfully with </span><span class="si">{name}</span><span class="s2">!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">blueprint</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="p">))</span>
</pre></div>
</div>
<p>If you are linking OAuth records to User records, you <em>must</em> implement an
<code class="docutils literal"><span class="pre">&#64;oauth_authorized</span></code> subscriber that creates new <code class="docutils literal"><span class="pre">User</span></code> and <code class="docutils literal"><span class="pre">OAuth</span></code>
database entries for any new users, and links those two new records via
the <code class="docutils literal"><span class="pre">OAuth</span></code> table&#8217;s <code class="docutils literal"><span class="pre">user_id</span></code> field.</p>
<p>If you&#8217;re using OAuth 2, the user may grant you different scopes from the
ones you requested: check the <code class="docutils literal"><span class="pre">scope</span></code> key in the <em>token</em> dict to
determine what scopes were actually granted. If you don&#8217;t want the <em>token</em>
to be <a class="reference internal" href="backends.html"><span class="doc">stored</span></a>, simply return <code class="docutils literal"><span class="pre">False</span></code> from one of your
signal receiver functions &#8211; this can be useful if the user has declined
to authorize your OAuth request, has granted insufficient scopes, or in some
other way has given you a token that you don&#8217;t want.</p>
<p>You can also return a <code class="xref py py-class docutils literal"><span class="pre">Response</span></code> instance from an event
subscriber. If you do, that response will be returned to the user instead
of the normal redirect. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span>

<span class="nd">@oauth_authorized</span><span class="o">.</span><span class="n">connect</span>
<span class="k">def</span> <span class="nf">logged_in</span><span class="p">(</span><span class="n">blueprint</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;after_oauth&quot;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="flask_dance.consumer.oauth_error">
<code class="descclassname">flask_dance.consumer.</code><code class="descname">oauth_error</code><a class="headerlink" href="#flask_dance.consumer.oauth_error" title="Permalink to this definition">¶</a></dt>
<dd><p>This signal is sent when the OAuth provider indicates that there was an
error with the OAuth dance. This can happen if your application is
misconfigured somehow. The user will be redirected to the <code class="docutils literal"><span class="pre">redirect_url</span></code>
anyway, so it is your responsibility to hook into this signal and inform
the user that there was an error.</p>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="proxies.html" title="previous chapter">Proxies and HTTPS</a></li>
      <li>Next: <a href="how-oauth-works.html" title="next chapter">How OAuth Works</a></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/signals.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <a href="http://github.com/singingwolfboy/flask-dance" class="github"><img src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>
  

  <div class="footer">
    &copy; Copyright 2014-2016, David Baumgold.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  
  </body>
</html>